<!DOCTYPE html>
<html>
  <head>
    <title>Week</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script
      src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script
      src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
	$(document).ready(function() {
  // Update chapter for all rows in the database
		  $("#update-chapter-btn").click(function() {
				var newChapter = $("#chapter-input").val();
				var group = document.getElementsByTagName("td")[6].innerText;
				$.ajax({
				  type: "POST",
				  url: "/update_data",
				  contentType: "application/json; charset=utf-8",
				  dataType: "json",
				  data:JSON.stringify( {"chapter": newChapter,"group":group}),
				  success: function() {
					// Reload the page to show updated data
						document.getElementById("myForm").submit();
						console.log("salam")

				  }
				});
				
			setTimeout(function(){// wait for 5 secs(2)
           location.reload(); // then reload the page.(3)
      }, 2000); 
			
		  });
  
  
  
  
});

	
	</script>
  </head>
  <body>
    <div class="container">
      <h1>Week</h1>
      <form id="myForm" action='@Url.Action(" Details"," Main", new { id=
        @Model.ID } )'></form>

      <div class="row mt-3">
        <div class="col-md-3">
          <input type="text" class="form-control" id="chapter-input"
            placeholder="New Chapter" value ="1">
        </div>
        <div class="col-md-3">
          <button class="btn btn-primary" id="update-chapter-btn">Update Chapter</button>
        </div>
      </div>




      {% if rows %}



      <div class="table-responsive">
        <table class="table table-striped" id="data-grid">
          <thead>
            <tr>
              <th>جنسیت</th>
              <th>نام</th>
              <th>فامیل</th>
              <th>جز </th>
              <th>تعداد صلوات</th>
              <th>موبایل</th>
              <th>Group</th>
            </tr>
          </thead>
          <tbody id="data-grid-body">
            {% for row in rows %}
            <tr>
              <td>{{ row[0] }}</td>
              <td>{{ row[1] }}</td>
              <td>{{ row[2] }}</td>
              <td>{{ row[3] }}</td>
              <td>{{ row[4] }}</td>
              <td>{{ row[5] }}</td>
              <td>{{ row[6] }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% elif selected_group %}
      <p>No data available for group {{ selected_group }}</p>
      {% endif %}
    </div>


  </body>
</html>
